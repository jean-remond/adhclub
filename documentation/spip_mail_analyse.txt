

De "Cédric Morin" <cedric.morin@yterium.com>
le 19/12/12 18:23
objet [SPIP Zone] Plugin Newsletters / Appel à testeurs
-------
Hello,

je viens de passer en mode test les 3 plugins Newsletters, Mailsubscribers et Mailshot pour SPIP 3.0


# Newsletters
http://zone.spip.org/trac/spip-zone/browser/_plugins_/newsletters/trunk

Permet la composition de newsletters à partir d'un squelette modèle choisi dans newsletters/
Pas de particularité, il y a un modèle newsletters/basic.html utilisable comme guide et ce devrait être assez 
	facile de convertir un modèle venant de spip-listes ou spip-lettres (je ne sais pas pour clevermail que je 
		n'ai pas pratiqué)

Une Newsletter est composée de 3 champs editoriaux : titre (qui sera le sujet du mail), chapo, et texte, et on 
	peut y associer une selection d'article au choix qui sont ensuite utilisables dans le squelette pour la 
	composition.


# Mailsubscribers
http://zone.spip.org/trac/spip-zone/browser/_plugins_/mailsubscribers/trunk

Gestion des abonnés. Permet l'import/export au format CSV ou texte simple. 
	Les abonnés antérieurs de spip-listes, spip-lettres, clevermail et mes_abonnes sont importés à l'installation.
Les formulaires d'inscription/desinscription sont nommés #FORMULAIRE_NEWSLETTER_SUBSCRIBE 
	et #FORMULAIRE_NEWSLETTER_UNSUBSCRIBE auquel on peut passer en argument optionnel un nom de liste 
	d'abonnement au cas par cas.

# Mailshot
http://zone.spip.org/trac/spip-zone/browser/_plugins_/mailshot/trunk

Gestion des envois de mail
Permet l'envoi en nombre avec monitoring de l'avancement, mise en pause/restart, abandon.

Le plugin necessite le plugin Facteur et permet de configurer un SMTP dédié à l'envoi en nombre (très conseillé)
Il refusera d'utiliser la fonction mail() de php si c'est la configuration du plugin Facteur. 
Cela peut paraître gênant mais c'est une bonne pratique volontaire pour éviter au serveur hébergeur de se 
	faire lister en spammeur par les fournisseurs de mails et de ne plus pouvoir ensuite envoyer les 
	mails de service.
Il est prévu de prendre en charge facilement des services d'envoi de mail en nombre.
On peut fixer un nombre maxi de mail/jour à envoyer. En l'absence de configuration de cette limite, la cadence 
	est volontairement limitée à 5mails/minute en dur dans le code (et toute cadence supérieure sera ignorée).

A l'installation, les historiques d'envoi de spip-listes et spip-lettres sont importés.

Il est préférable d'utiliser la branche stable 
	http://core.spip.org/projects/spip/repository/changes/branches/spip-3.0 en révision 20062 mini 
	(mais les plugins doivent être fonctionnels avec une version SPIP 3.0.5 même si ils présentent quelques 
	défaut d'interface dans ce cas)

Tout retour de test sera le bienvenu !

Cédric

-------

De "freebsnet" <freebsnet@free.fr>
le 24/11/12 12:14
objet : [SPIP Zone] Plugin Abonnements NewsLetter
-------
bonjour,
+ 10
cordialement

Le 24/11/2012 11:51, Spip listes a écrit :
> Bonjour,
>
> mon petit grain de sel dans cette conversation (qui est par ailleurs passionnante sur le fond) à propos des 
	désignations qui semblent faire consensus : newsletter et mail (email, e-mail, etc).
>
> Il serait peut-être temps de réfléchir à des termes qui sont de plus en plus utilisés dans la Francophonie. 
	Au Québec, nous utilisons avec bonheur et avec facilité les appellations "infolettre" et "courriel". 
	Si vous faites une recherche Google, vous constaterez que les entreprises, gouvernements et autres entités 
	telles que les bibliothèques nationales et les universités, utilisent le terme infolettre. Pour prendre 
	quelques exemples plus consistants pour le terme "mail", l'ONU utilise courriel alors que votre BNF utilise 
	courrier électronique.
>
> Concernant la recherche d'un outil «plugin» avec le mot newsletter, je pense que chacun arrivera à trouver le 
	bon outil même si le plugin ou les racines de la DB s'appellent "infolettre". Peut-être que dans quelques 
	années le terme "newsletter" sera en désuétude chez-vous (je le souhaite) et vous ne regretterez pas d'avoir 
	opté pour un terme français qui signifie exactement la même chose, même en plus clair.
>
> Il y a des termes utilisés dans SPIP qui sont très bien utilisés et dont je suis très fier, tel que par exemple, 
	la médiathèque. J'ajoute que je ne suis pas un puriste de la langue (j'aurais utilisé "greffon" plutôt que 
	"plugin"), je suis juste un utilisateur normal de la langue française.
>
> Il me semble que la possibilité qui existe d'utiliser des termes clairs en français est un élément important 
	à prendre en considération.
>
> Richard

-------

De "Cédric Morin" <cedric.morin@yterium.com>
pour "JLuc" <jluc@no-log.org>
le 21/11/12 09:43
objet : [SPIP Zone] Plugin Abonnements NewsLetter
-------
Le 21 nov. 2012 à 09:30, JLuc a écrit :

> Le 15/11/2012 19:43, Cédric Morin a écrit :
> > je vais entamer un chantier de reorganisation des outils de newsletter
>
> Parmi les choix que tu as fait, il y a ce me semble le choix de ne proposer qu'une seule ml par site ?
> C'est à mon avis ce choix qui risque le plus de friser les 21% de besoins non satisfaits.
> Il faudrait donc prévoir les points d'entrée ou interfaces pour un développement ultérieur ou un plugin qui 
	satisfasse ces 21% restant.
>
> Pour ma part je serai ravi de migrer mes usages et occasionnels efforts de codage vers un plugin de ml moderne, 
	robuste et fédérateur.
>
> Cela suppose quelques possibilités ou possibilités d'évolution ou extension :
> l'usage que j'ai de spip-lettres se fait systématiquement "hors abonnement", par l'envoi du courriel aux emails 
	issus d'une requête SQL.

Ah ben ça legitime complètement l'approche séparée entre gestion des inscriptions et composition de la newsletter.
Dans ton cas tu n'as donc pas besoin d'un plugin de gestion des inscriptions, juste d'un mini plugin qui supporte 
	l'api (à figer&documenter) et fournit la listes des emails issus de ta requete sql.
Et de ce point de vue, la gestion des différentes listes est juste un choix fait dans le dev du plugin 
	mailsuscribers, pas une contrainte structurelle (ie ton miniplugin peut très bien distinguer plusieurs listes 
		et selections)

> Par ailleurs je souhaite pouvoir personnaliser le contenu de la lettre en fonction des autres champs de cette 
	requête.
> J'espère qu'il y aura la possibilité de brancher un tel fonctionnement.

A voir.
Cédric

-------

De "Nicolas Hoizey" <nicolas@hoizey.com>
copie "Cédric Morin" <cedric.morin@yterium.com>
le 19/11/12 21:02
objet : [SPIP Zone] Plugin Abonnements NewsLetter
-------
2012/11/19 Cédric Morin <cedric.morin@yterium.com>

    Le 19 nov. 2012 à 17:13, Nicolas Hoizey a écrit :
>     Je dépile la liste avec pas mal de retard, et y découvre que cette initiative qui me plait beaucoup avance 
	bien, c'est cool !
>     Je tenterais de participer à ces nouveaux plugins autant que possible, notamment pour faire profiter des 
	aspects qui m'ont conduit à concevoir CleverMail tel qu'il est. Si on peut effectivement aboutir à un lot de 
	plugins unifiés qui permettent de réduire les existants uniquement à leurs aspects les plus spécifiques, ce 
	sera top. Je suis d'accord avec l'approche consistant à servir d'abord les besoins les plus courants, et avec 
	des interfaces les plus simples possible.
>
>     Parmi les points déjà évoqués, sur lesquels j'ai un avis :
>     - Je suis d'accord que demander à l'utilisateur s'il veut recevoir en HTML ou en texte brut ne sert que 
	très rarement, mettre les deux dans le mail envoyé suffit. J'ai par contre mis dans CleverMail un squelette 
	pour la version texte parce que je n'étais que rarement satisfait des versions texte obtenues automatiquement 
	à partir des versions HTML. Je préfère passer un peu de temps sur un squelette de version texte qui m'évitera 
	ensuite toute retouche manuelle, l'investissement est vite rentabilisé.
	 
    Oui on parlait de permettre d'avoir un squelette pour la version texte, mais en l'absence d'avoir une génération automatique du contenu texte.

Nickel, j'ai loupé cette partie dans le thread… ;-)

>     Cela me permet en plus d'utiliser plus simplement le format TEN ( http://www.headstar.com/ten/ )
    je connaissais pas, et je n'ai pas bien compris ce que c'est :(

Une assez vieille tentative de standard de structuration/formatage de mail texte pour faciliter la lecture, 
	notamment avec les aides techniques pour l'accessibilité.

>     - Pour la terminologie, quasiment tous ceux qui se tournent vers CleverMail ont cherché un plugin de 
	"newsletter". OK c'est de l'anglais, mais cela me semble tellement largement utilisé même chez nous que ça 
	semble le meilleur nom possible. C'est bien d'avoir des noms en français, des jeux de mots et autres blagues, 
	mais le but c'est quand même que les futurs utilisateurs des plugins les trouvent. 
	
    j'en suis arrivé là aussi donc je pense qu'à défaut d'être court, ce sera explicite :

    newsletter_inscription
    newsletter_composition
    newsletter_envoi

    (peut être même sans le _ a cause des fichiers de langue...)

Nickel.

>     Toujours sur la terminologie, personnellement je m'«abonne» à une newsletter, comme à un magazine.

    C'était aussi mon avis, mais là il semble que l'usage général soit de s'inscrire à une newsletter.
    Je pense donc retenir ce terme pour tout le plugin, ce qui n'empêchera pas d'afficher une chaine de la 
    	forme "S'abonner à la newsletter" pour ceux qui préfèrent, par simple surcharge de la chaine de langue 
    	(la question se posant essentiellement en français)

OK

>     Pour ce qui est de l'inscription, le mail de confirmation/infirmation me semble nécessaire. C'est une 
	confirmation dans CleverMail, mais je suis d'accord que l'infirmation doit être bien plus rare, donc doit être 
	privilégiée. Entre cliquer sur un lien pour ouvrir une page de navigateur puis supprimer le message, ou juste 
	supprimer le message, il n'y a pas photo.
	
    D'après ce que disait Klaus, certains pays nécessitent une confirmation explicite traçable, ce qui impose de pouvoir utiliser une confirmation par mail. A partir de là faisons simple : par defaut c'est un mail informatif qui permet d'infirmer l'abonnement (en cas d'erreur ou de mauvaise blague), et on peut activer une confirmation explicite pour les pays dont la legislation le necessite.


Parfait !

-- 
Nicolas HOIZEY
http://gasteroprod.com/

-------
De "Arnaud Bérard" <arnaud.berard@mister-graphx.com>
le 19/11/12 20:46
objet [SPIP Zone] Spip listes sur spip 3
-------
Le 19/11/12 14:24, Suske a écrit :
> Trop d'erreurs en tous cas pour que je uppe des sites en SPIP 2.1 qui envoient des newsletters :-/
Idem, pourtant j'ai des site qui envoient a plus de 11000 inscrit plusieurs fois par mois avec ce plugin 
	sous spip2.1. qui était/est bien pratique

pour pouvoir les passer en 3 je vais surement opter pour la solution MailJet je pense, ça réglera le problème 
	du blacklistage, des quotas et c'est gratuit j'usqu'a 6000envois par mois avec statistiques ... bref ça répond 
	à la demande de la plupart des "petits sites" avec un seul plugin et un service externe

Arnaud B.
-------
De "klaus++" <klaus@spip.de>
le 19/11/12 13:48
objet : [SPIP Zone] Plugin Abonnements NewsLetter
-------
Salut,

la question a été soulevé s'il faudrait une démarche opt-in / opt-out avec ou sans confirmation par mail.

Le législation allemande oblige les sites Web à utiliser un système d'abonnement avec opt-in et confirmation 
	par mail/clé de vérification.

Tout autre solution comporte le risque d'une "Abmahnung" parfois très coûteuse par des concurrents accompagnée 
	d'une note de frais de l'avocat du concurrent (entre € 3.000 et € 12.000). L'idée derrière cette procédure 
	est la protection des consommateurs.

Je ne crois pas que ce soit efficace comme protection contre des SPAM, mais il y a une véritable industrie legale 
	autour les "Abmahnung" qui vie comfortablement des frais légalement imposés aux webmestres imprudents. 
	(cf. "Abmahnfalle") Il faut savoir que tout site web est considéré comme une activité économique par notre 
	jurisprudence constante dès qu'il commence à régulièrement publier des articles.

Une solution d'abonnement aux lettres d'information qu'on peut utiliser pour un site allemand propose donc la 
	possibilité de régler le processus d'abonnement de manière à ne considérer l'abonnement comme effectif qu'une 
	fois le propriétaire de l'adresse ayant fourni une preuve de sa volonté de recevoirs des messages.

Ceci n'empêche pas d'utiliser des démarches plus simples, mais elles sont limités aux sites situés hors 
	d'Allemagne et sous un TLD autre que .de

klaus++

P.S. Théoriquement un tribunal allemand pourrait même délivrer un mandat d'arrêt européen pour saisir le 
	responsable d'un site web européen n'ayant pas respecté ce règlement.

Quelques liens d'actualité :
http://www.it-recht-kanzlei.de/abmahnung-unverlangt-zugesandter-email-newsletter.html

http://www.internetworld.de/Nachrichten/E-Commerce/Praxistipps/Abmahnfalle-AGB-Achtung-Stolperfalle-71357.html
-------
De "Cédric Morin" <cedric.morin@yterium.com>
pour "klaus++" <klaus@spip.de>
le 19/11/12 13:43
objet : [SPIP Zone] Plugin Abonnements NewsLetter
-------
Le 19 nov. 2012 à 13:16, klaus++ a écrit :

> La possibilité d'éditer manuellement une version texte n'exclut pas de faire convertir/rajouter automatiquement 
	pasr le facteur une versiontexte aux mais. Il faudrait juste que ce soit une option dans l'interface de config 
	du facteur. En plus il faudrait s'assurer que le facteur ne touche pas aux mails correctement composés 
	(avec une version html _et_ texte).

Je pense que c'est "editer la version texte" qui doit être une option, car ne concerne que peu d'utilisateurs 
	(selon la règle : le plugin fait bien par défaut ce dont 80% des utilisateurs ont besoin ; le reste est 
	optionnel/plus compliqué...)
Et en effet, si l'utilisateur a édité la version texte, celle-ci ne doit plus être modifiée par la suite.

Cédric

>
> klaus++
>
>
> On 16.11.2012 16:23, BoOz wrote:
>> Bah t pas obligé de l'éditer si ca te fait *** , mais si c'est converti au moment de la composition, ca laisse 
	la possibilité de l'éditer si on veut, alors que si c apres, non.
>>
>> BoOz
>>
>>
>> Le 16 novembre 2012 16:09, Fil<fil@rezo.net>  a écrit :
>>
>>> Bien qu'utilisant le truc de BoOz je suis d'accord avec Klaus, car éditer manuellement la version texte c'est 
	trop ch****.
>>>
>>>
>>> 2012/11/16 BoOz<booz@rezo.net>
>>>
>>>> Hi,
>>>>
>>>> Il vaut mieux faire la version texte dans la partie composition je pense.
>>>> En automatique, avec possibilité de reediter par dessus. C'est ce que
>>>> propose le plugin que je vais commiter prochainement.
>>>>
>>>> BoOz
>>>>
>>>> Le 16 novembre 2012 15:36, klaus++<klaus@spip.de>  a écrit :
>>>>
>>>> Coucou et merci pour l'initiative.
>>>>>
>>>>>
>>>>>  L'abonnement ne gèrera pas non plus de format (mixte, email, texte) car en pratique 99,99% des abonnés 
	s'en fichent et ne savent pas quoi cocher, reçoivent très bien leurs email en html. Les rares qui tiennent 
	vraiment à avoir un email texte sont capable de règler cela dans leur client mail. Qui plus est, la 
	composition des newsletter se fait toujours en html.
>>>>>>
>>>>>
>>>>> Faisant partie de cette minorité d'utilisateurs mail qui ne lisent (et envoient) que des mails au format 
	texte, je me trouve souvent devant des mails qui m'obligent à changer la config de Thunderbird pour les 
	afficher.
>>>>> Ca me met de mauvaise humeur et je ne le fait que pour les mails de ma compagnie de téléphone. 
	Les autres expéditeurs qui envoient des m... pareilles finissent dans mon filtre de SPAM.
>>>>>
>>>>> D'ou ma proposition : Faire faire le travail nécessaire au facteur. Un mail HTML qui se respecte arrive 
	toujours avec sa version texte. Elle me laisse la liberté de décider si je veux consulter sa version HTML 
	ou texte.
>>>>> Côté programmation c'est facile à réaliser : Il suffit de prendre la version HTML, d'enlever les balises 
	et d'attacher cette version après la version HTML (c'est bien documenté, alors je n'explique pas comment faire).
>>>>> On pourrait ajouter cette fonction là où le site envoie les mails et ajouter un choix supplémentaire à 
	l'interface de configuration du facteur "ajouter une version texte aux mails HTML".
>>>>>
>>>>> klaus++
>>>>>
>>>>> ______________________________**_________________
>>>>> spip-zone@rezo.net - http://listes.rezo.net/**mailman/listinfo/spip-zone<http://listes.rezo.net/mailman/listinfo/spip-zone>
>>>>>
>>>>
>>>>
>>>> _______________________________________________
>>>> spip-zone@rezo.net - http://listes.rezo.net/mailman/listinfo/spip-zone
>>>>
>>>>
>>>
>>>
>>> --
>>> Fil

-------
De "Gildas Cotomale" <gildas.cotomale@gmail.com>
pour "Cédric Morin" <cedric.morin@yterium.com>
le 17/11/12 09:46
objet : [SPIP Zone] Plugin Abonnements NewsLetter
-------
Hello

>> Le découpage semble sympa mais
>> pour la partie dite bafouille_abonne on a un plugin coordonnée et
>> contact qui géré déjà ce type d'information. Je trouve dommage de ne
>> pas pérenniser cet existant (même si potentiellement imparfait)
>
> Je crois que tu inverse la proposition. Si un site gère des cordonnées de clients/contacts/whatever il peut vouloir aussi y gérer l'abonnement à la newsletter. Donc dans ce cas il suffira que ton plugin de coordonées supporte l'API commune pour être utilisé pour ça.
> Mais la plupart du temps, les sites n'ont qu'une newsletter et ne gèrent pas de fichier client. Il n'y a aucune raison de s'appuyer sur une grosse machinerie pour faire une fonction simple comme celle là.
>
> La question n'est pas négligeable, car je rappelle que si tu as ce type de fichier avec coordonées personelles tu dois le déclarer à la CNIL. Alors qu'une simple table d'emails pour un abonnement à la newsletter ne nécessite pas de declaration.
>
En fait c'est "coordonnées" au sens large, incluant l'email
(adresse/coordonnée électronique !) pour lequel ce plugin a une
table... D'où la pertinence de la remarque de Cam.

Par contre, l'idée du plugin Coordonnées est de pouvoir lier plusieurs
coordonnées à un objet SPIP (en général un auteur). Là il peut y avoir
une objection plus compréhensible si les inscrits/abonnés à la lettre
ne sont pas forcément inscrits au site (auteurs donc, qu'ils soient
rédacteurs ou simples visiteurs)
-------
De "erational" <erational@erational.org>
le 16/11/12 01:43
objet : [SPIP Zone] Plugin Abonnements NewsLetter
-------
hello,

aucun soucis pour diverger du plugin mes-abonnes
le plugin mes-abonnes est volontairement simple pour le pouvoir le modifier facilement via le simple CVT
le nouveau plugin risque d'être plus sophistiqué

quelques points qui reviennent souvent:

- la question de l'opt-in
soit en cochant ou en validant une page de confirmation avec un hash ?

- la question des champs extras
prévoir un point d'entrée pour permettre selon les cas d'avoir un nom, prénom, une préférence (type checkbox)
et les retrouver facilement dans l'export ou dans la lettre ?

- le formulaire de désabonnement
faut il prévoir un formulaire via une balise ou plutôt prévoir une page avec un hash transmise lors de l'envoi de 
	la lettre ?

-------
De "Franck_" <spip.franck@lien-d-amis.net>
le 15/11/12 23:20
objet : [SPIP Zone] Plugin Abonnements NewsLetter
-------
Merci Cédric pour ce que tu vas faire !

Concernant le nom, le truc de
bafouille_abo
bafouille_compo
bafouille_envoi

Je trouve ça simple et comme ils commenceraient tous pareil, ils seraient « facile » de les trouver via SVP

Je ne suis pas trop pour « billet » car je pense plus billet de train ou spectacle qu’a une Newsletter, message, 
	me fait penser au sms des portables (dû au fait que l’icône sur l’Iphone porte le nom de « message ») ; 
	je serais plutôt pour « lettre » ou « missive »

Par contre, je ne suis pas trop pour « abo » et « compo » à la place des mots entier « abonnement » et 
	« composition »
 
Par contre, j’aurais une remarque à faire concernant le champ « statut » dans la table abonnés, il ne faudrait 
	pas, en plus « en attente » ?

Il indiquerait que la personne c’est inscrit, mais que l’admi n’a pas encore valider l’inscription (pour lutter 
	contre ceux voulant s’inscrire avec des adresses mail « louche » ou autre)

 

Par contre, j’aurais une demande, serait-il possible que concernant le plug « envoi », l’on puisse régler la 
	vitesse d’envoi des mails ? Je me sers de spip-lettre en spip 2.1, mais comme il n’y a pas réglage possible, 
		j’ai parfois de nombreuses tentatives d’envois avant que cela parte, et donc parfois des échecs …

Donc, voilà, serait-il possible que dans les réglages du plug, l’on puisse faire les réglages de vitesse d’envoi ?

Exemple, chez 1and1 il faudrait pouvoir regler : http://faq.1and1.fr/hebergements/quotas/6.html

Je me doute que je demande peut-être quelque chose de complexe et que tu n’as peut-être pas idée de faire quelque 
	chose qui soit « réglable » donc, je comprendrais parfaitement que tu ne le fasses pas.

En tout cas, encore merci à toi Cédric pour ce que tu fais concernant Spip !

Franck

-------

De "assobachant" <asso.bachant@laposte.net>
le 15/11/12 19:58
objet : [SPIP Zone] Plugin Abonnements NewsLetter
-------

alors comme tous le monde va y aller de son petit nom , je propose
bafouille
pour la déclinaison :
bafouille_abo
bafouille_compo
bafouille_envoi

Bafouille ayant pour synonyme billet, lettre, message, missive

-------

De Cédric Morin
Le 15/11/2012 19:43
objet : [SPIP Zone] Plugin Abonnements NewsLetter
-------
> Hello,
>
> je vais entamer un chantier de reorganisation des outils de newsletter pour SPIP 3, en commençant par la gestion des abonnés (premier tome d'un triptyque abonnement/composition/envoi pour les newsletter)
ah super ....
>
> Voici ce que j'imagine, en grande partie basée sur l'existant initial du plugin mes_abonnes duquel je pense partir
>
> # Description
>
> Dans un premier temps, je ne compte pas gérer les listes d'abonnement multiples, ce sera une évolution future car cela ne concerne que peu de sites en pratique. Et je préfère qu'on arrive a un plugin qui fait bien ce qu'il fait plutot qu'a moitié plein de choses.
>
> L'abonnement ne gèrera pas non plus de format (mixte, email, texte) car en pratique 99,99% des abonnés s'en fichent et ne savent pas quoi cocher, reçoivent très bien leurs email en html. Les rares qui tiennent vraiment à avoir un email texte sont capable de règler cela dans leur client mail. Qui plus est, la composition des newsletter se fait toujours en html.
>
> Les abonnés seront gérés dans une table des abonnés avec les champs nom, email, lang, statut (abo/desabo/poubelle).
> A l'installation, le plugin sera en mesure d'importer automatiquement les abonnés depuis une base spip-listes, spip-lettres, clevermail ou mes-abonnes (Même si le plugin en gère pas les infos de liste d'abonnement, il faut probablement importer cette information pour ne pas la perdre si elle existe ? dans un second temps ?)
>
> Je me pose une question de nommage. La notion d'abonné/abonnement est en fait plus large que le cas que l'on va traiter ici et qui concerne spécifiquement de l'envoi d'information par email. Doit-on/Peut-on nommer les choses de manières génériques "abonne" ou doit on prefixer par quelque chose comme un "nl" (newsletter), ou mail ou email (on aurait des nlabonnes ou des mailabonnes ou des emailabonnes ou je ne sais quoi ?)
> La question vaut notamment pour la suite de l'api décrite ci-dessous (je laisse les termes génériques par comodité ici)
>
> # API
>
> L'API proposée serait la suivante (idéalement implémentée dans tous les pugins de gestion des abonnés/newsletter pour permettre leur interoperabilité)
>
> Pour les squelettes :
>
> #FORMULAIRE_ABONNEMENT : le formulaire qui gère l'abonnement/desabonnement. Un nom unique, car les squelettes n'ont pas à deviner quel plugin a en charge les abonnements/desabonnements. Ils peuvent ainsi insérer ce formulaire sur la page d'abonnement une fois pour toute
>
> Pour les interactions avec d'autres plugins ou scripts  (c'est encore macroscopique, je ne detaille pas ici les arguments ni le retour, j'essaye surtout de lister les points d'entrée/sortie nécessaires)
>
> abonner() permet d'abonner une personne
> desabonner() permet de desabonner une personne
> lister_abonnes() liste les abonnes
> abonnement_infos() donne les information complète sur un abonnement d'une personne (donc y compris son status abonné/desabonné)
> abonne_url_desabonnement() fournit l'url de desabonnement d'un abonné (redondant avec la fonction précédente ?)
> # Developpement
>
> La question du nom du plugin se pose, comme indiqué plus haut. Je pense qu'il faut un nom de famille que l'on décline ensuite sur les 3 fonctionnalités abonnement/composition/envoi qui vont former 3 plugins en interaction
>
> Je pense que je vais créer un répertoire dédié à ce plugin, même si il part initialement de mes_abonnes, car le processus de developpement va diverger par rapport à ce plugin initial et ça ne me parait pas judicieux de le considérer comme une évolution, mais peut-être je me trompe ?
>
> Je suis preneur de toute remarque, suggestion, aide, pour mieux définir le contour de ce plugin, ainsi que son nom !
>
> Cédric

-------

De "JLuc" <jluc@no-log.org>
le 03/11/12 18:36
Objet : [SPIP Zone] Refonte des lettres
-------
Après que les liens se soient ajoutés les uns aux autres,
un commentaire pour peut être en retirer un :

J'ai récemment utilisé un template de
http://www.campaignmonitor.com/templates
et constaté qu'il ne répondait pas du tout à mes attentes,
puisque la mise en page n'était absolument pas compatible
avec un assez grand nombre de lecteurs de mails web ou non.

Les styles css y sont en effet défini au début dans le head
... et ne sont pas appliqués ensuite sur les lecteurs rétros.
J'ai du transformer le template pour l'avoir en version inline.
Quelqu'un comprend l'intérêt de ces supposés mails templates idéaux ?

JLuc
-------

De "Ybbet SPIP" <teddy.spip@gmail.com>
le 03/11/12 16:27
Objet : [SPIP Zone] Refonte des lettres
-------
On continue sur les bonnes astuces et les bonnes pratiques.
Ce site :
http://inlinestyler.torchboxapps.com/
permet de mettre les "style=" à vos balises pour une bonne interprétation. Il prend en compte les héritages.
Vous faites un copier-coller de votre code de <html> à </html> avec un <style> dans votre head. Et la moulinette 
	se charge de tout refaire pour un email html standard.

-------

De "Julien Lanfrey" <julienlfy@gmail.com>
pour "Ybbet SPIP" <teddy.spip@gmail.com>
copie "RealET" <real3t@gmail.com>
le 03/11/12 11:58
Objet : [SPIP Zone] Refonte des lettres
-------
oui,

et hop, un de plus :
- http://www.pompage.net/traduction/emails-html-dompter-la-bete

J'y ajoute ce que j'ai retenu de mes veilles et "déboires" ces dernières années :
- Préférer les layout en pure table, à l'ancienne, oublier le xhtml (si si !).
- Oublier les css (dans le head) et tout faire "inline" avec des "style=" de partout. (la redondance est donc de 
	mise) (ex:gmail)
- Préférer les entités html (accents) : encodage varié des webmails
- Pas de background-image (c'est juste pas possible sur certains outlook)
- Limiter les floats et les doubler par des align=left/right - image flottante dans un article par 
	exemple (outlook).
- Fond coloré sur les images... (plus sympa qd les images sont bloquées (gmail, aol, certains outlook, ...)

et de toute façon : tester encore et encore...

Julien

-------
Le 2/11/12 23:56, Ybbet SPIP <teddy.spip@gmail.com> a écrit :

    Bonsoir,
    Dans ces liens je rajouterai : http://www.email-standards.org/

-------
Le 2/11/2012 à 23:43, RealET a écrit :

    > * RastaPopoulos tapuscrivait, le 20/10/2012 20:45:
    > Juste pour réagir sur tout ce qui a été dit du HTML qui marche ou marche pas, des CSS... Toussa...
    > Lors de ma veille, j'ai trouvé :
    > - http://htmlemailboilerplate.com/ : un framework de départ
    > - https://www.getfractal.com/index.php/ pour "réparer" un HTML de NL
    > - http://www.campaignmonitor.com/css/ qui supporte quoi en CSS
    > - http://www.sitepoint.com/code-html-email-newsletters-3/
    > - http://www.sitepoint.com/designers-guide-html-email/
    > - https://www.mailrox.com/ pour fabriquer un template de NL à partir d'une image
    >
    >
    > --
    > RealET
    >
-------

De "JLuc" <jluc@no-log.org>
le 25/10/12 15:15
Objet : [SPIP Zone] Refonte des lettres
-------
Le 23/10/2012 12:08, Cédric Morin a écrit :
> Le 23 oct. 2012 à 11:51, Fil <fil@rezo.net> a écrit :
>>> et cette solution me semble préférable si elle évite de lancer toute la
>>> machinerie hyper polyvalente du compilateur spip.
>> As-tu réellement mesuré cela ? Le compilateur n'est appelé qu'une
>> fois, et produit un code compilé aussi optimisé que possible ; ensuite
>> si le squelette est simple (peu de boucles), son calcul pour chaque
>> destinataire s'effectue ensuite très vite — peut-être même plus vite
>> que les %% faits "à la mano".
>>

-------
Cerdic a écrit aussi que > Qui plus est
> - ce sont les mêmes requêtes d'un destinataire à l'autre (ou alors la squelette fait des choses impossibles avec 
	un %%), donc cachées.
> - tout l'exécuteur est déjà chargé en mémoire pour le calcul initial de la lettre.
> - la transaction smtp avec le serveur mail prend plus de temps que le calcul de la lettre lui même.
> À contrario gérer une syntaxe spécifique nécessite un apprentissage de l'utilisateur, la maintenance d'un code 
	et d'une doc associée, et à toute les chances d'intégrer des bugs spécifiques difficilement décelables dans 
		la mesure ou l'on ne vérifie pas chaque lettre envoyée une à une.
>
> Les maigres avantages supposés de la syntaxe specifique ne pèsent pas grand chose devant les inconvénients avérés.
>
> Cependant il y a un vrai impact à prendre en compte :
> - avec un calcul unique on est sur que la NL est identique pour tout le monde. - avec un calcul pour chaque 
	destinataire on peut se retrouver avec une disparité si la campagne d'envoi est longue (bcp d'abonnés et envoi 
	par le site), que le gabarit utilise une boucle genre "les 3 articles les plus récents" et qu'un nouvel 
	article est publié pendant l'envoi...

Hello,

Non Fil, je n'ai pas mesuré la différence mais ça mériterait effectivement.

On avait déjà parlé il y a longtemps d'appeler le compilateur interpréteur de spip
mais ça bloquait à l'époque sur le fait que le "texte" traité
devait être dans un fichier. Tu avais dit qu'il n'y avait qu'à changer cela
(et permettre de prendre une chaine en entrée et non un fichier).

Ensuite Cerdic, pour ta préoccupation de
"toutes les lettres doivent être générées au même moment pour refléter le même contenu de la base",
l'envoi a bien lieu de manière étalée dans le temps, mais c'est un 2eme environnement qui est utilisé :
l'environnement restreint aux caractéristiques du destinataire
(champs extras ou aux paramètres explicitement passés en paramètres par l'API)
et non l'environnement relatif à la base, aux articles, etc.
Cette "limite" exclue a priori les problèmes de lettres qui bougent toute seule.

JL

-------

De "RastaPopoulos" <rastapopoulos@spip.org>
le 20/10/12 20:46
Objet : [SPIP Zone] Refonte des lettres
-------

Les plugins existants :
=======================
- SPIP-Listes (tout)
- SPIP-Lettres (tout)
- Clevermail (tout)
- Abomailman (composition et envoi vers logiciel externe)
- ML Sympa (gestion des listes et des abonnés de Sympa avec SOAP)
- Gestion ML avec Soap (un peu pareil mais pour ezmlm)
- Mes abonnés (gestion de...)
- Ma lettre (composition de lettre et envoi vers une seule adresse)
- BoOz a un truc de composition et un truc de suivi des clics en réserve

Ce qui serait souhaitable :
===========================
Un découpage par fonction sachant que plusieurs plugins peuvent faire la
même chose différemment :
- Lister des listes
  - soit en interne
  - soit par l'API de logiciels externes
- Lister des abonnés
  - soit en interne
  - soit par l'API de logiciels externes
- Écrire des lettres
  les lettres *peuvent* être liées à une liste (telle lettre pour telle
liste)
- Envoyer les lettres
  - soit à un logiciel externe qui fera le routage
  - soit par Job queue en interne si on a une liste d'abonnés

Pour le plugin d'écriture :
===========================
- un sujet (un titre)
- un texte
- lier des objets éditoriaux (pas forcément que des articles)
- je pense qu'il faut générer TROIS choses :
  - une version texte brut
  - une version HTML *pour le mail* (<table> etc)
  - une version HTML *web* car lorsqu'on voudra afficher les archives
des lettres envoyées, ça sera mieux d'avoir une version dédiée au web et
non pas un truc en <table> en 600px de large
- le contenu généré est enregistré tel quel (base ou fichier) afin de
garder une trace si jamais le contenu du site change (pour les objets
liés notamment)

Pour la gestion des clics :
===========================
- est-ce que ça doit être dans un plugin séparé ou bien dans celui qui
gère les lettres ?
- on peut se dire que ce besoin peut servir à d'autre chose que des lettres
- ça doit aussi pouvoir compter les clics sur des liens externes, si
dans la lettre on met des liens vers autre part
- un lien est lié à une lettre (ou autre contenu objet/id_objet si
jamais c'est générique) car une même URL peut se trouver dans plusieurs
contenus et donc il faut pouvoir distinguer les clics
- si ce plugin est générique, un plugin de régie publicitaire pourrait
alors le nécessiter et déléguer le comptage des clics à ce plugin, ça
ferait des choses en moins à maintenir et des interfaces unifiées

Voilà mes quelques notes pour le moment. Il est possible que j'ai moi
aussi à m'y mettre sous peu. Ce fil est dédié à la refonte et au
découpage au propre.

Rapidement je crois qu'il y a au moins Pierre, Cédric, Jean-Luc, Nicolas
d'intéressés par le sujet (en tant que dev).

Bisous et bonne fin de week-end.

-- 
RastaPopoulos
-------


F(Spip_lettres) : lettres_sql_programmer_envois

Ses parametres sont :
  $id_lettre : l'identifiant de la lettre envoyée
et
  $select, $from, $where, $groupby, $orderby, $limit, $having, $serveur, $option : 
  	les paramètres de l'API SQL de spip
tels que documentés pour la fonction sql_select cf http://programmer.spip.net/sql_select,569
Souvent, il suffit de préciser $select, $from et $where pour faire la requête requise.
